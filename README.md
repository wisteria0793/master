# 修士論文の研究取り組み

## 研究テーマ
**地区特性を考慮した観光ルート推薦システムの構築**

本研究は、機械学習モデルを用いて、観光地特有の雰囲気や情緒的な特性を定量化し、それを活用した新しい観光ルート推薦システムの構築を目指すものです。

---

## 実験1: データ収集
### 手順
観光地の特性を分析するための基礎データとして、以下のソースから情報を収集しました。
- **施設紹介文**: 函館市の観光公式サイト「はこぶら」から収集。
- **施設情報**: Google Places APIを利用して、POI（Point of Interest）のカテゴリや座標などを取得。
- **観光写真**: Flickr APIを通じて、観光客が撮影した写真を収集。

---

## 実験2: データ分析
収集したテキストデータを用いて、地区の特性を表現するためのベクトル表現を生成・評価しました。

### 2-1. LDAによるトピッククラスタリング
#### 手順
「はこぶら」の施設紹介文全体に対してLDA（Latent Dirichlet Allocation）を適用し、トピックごとにPOIをクラスタリングしました。

#### 結果
[**実験2-1の結果**](..docs/results/2-1.md)

Sentence-BERT（後述）で算出した紹介文ベクトルの類似度を元に評価したところ、LDAによるクラスタは、意味的なまとまりが弱いことが判明しました。これは、名詞の有無に関わらず同様の傾向でした。<br>

#### 考察
LDAは単語の共起に基づいてトピックを抽出するため、文脈や意味の類似性を捉えるのには限界があると考えられます。したがって、地区特性の分析手法としては不十分であると結論付けました。

---

### 2-2. 埋め込み表現によるベクトル化と比較
#### 手順
文脈を捉える能力に優れた事前学習済みモデルを用いて、施設紹介文の埋め込み表現（ベクトル）を作成しました。
- **使用モデル**:
  - `Sentence-BERT`: 文章全体の意味を捉えることを得意とするモデル。
  - `CLIP`: テキストと画像を共通のベクトル空間で表現できるマルチモーダルモデル。
- **比較実験**:
  1.  **オリジナルベクトル**: 施設紹介文をそのままベクトル化。
  2.  **差分ベクトル**: 施設の「機能（カテゴリ）」を表すベクトルを差し引くことで、「情緒的な特性」のみを抽出しようと試みました（単純な減算と直交射影による方法を比較）。
  3.  **概念プローブ**: 「美味しいコーヒー」のような具体的な概念（フレーズ）との類似度を計算し、ベクトルの表現能力を評価。

#### 結果
[**実験2-2の結果**](..docs/results/2-2.md)
- Sentence-BERTでは、カテゴリベクトルを減算した方が、減算しない場合よりも意味的にまとまりのあるベクトル表現が得られました。
- 一方で、概念プローブによる評価では、ベクトル減算によって逆に重要な特性が失われてしまう「諸刃の剣」であることが示唆され、今回はこのアプローチが有効でないと判断しました。
- モデル比較では、CLIPよりもSentence-BERTの方が、概念に対してより妥当性の高いPOIを上位に表示する結果となりました。

#### 考察
施設紹介文のベクトルから単純にカテゴリベクトルを引くだけでは、意図した「情緒的な特性」を綺麗に分離することは困難でした。現状では、減算を行わない**オリジナルの施設紹介文ベクトル（特にSentence-BERTによるもの）**を以降の分析で使用するのが最も妥当だと考えられます。

---

## 実験3: 階層的クラスタリングによる地区特性の定義
### 手順
実験2-2で得られたSentence-BERTの埋め込み表現に対し、階層的クラスタリングを適用しました。そして、行政区画内のクラスタ構成比率を「地区特性」と定義し、ルート生成を試みました。

<img src="./images/IMG_2545.jpeg" alt="学会参加時の様子" width="400px">

### 結果・考察
[**実験3の結果**](..docs/results/3.md)
2023年10月中旬の学会でポスター発表を行った際、「クラスタの構成比率を地区特性とするのは論理に飛躍があるのではないか」との指摘を受けました。これは自身でも感じていた課題であり、この定義の妥当性が低いことを再認識しました。

今後は、行政区画のような人為的なルールベースではなく、データそのものから地区のまとまり（エリア）をボトムアップに発見するアプローチが必要です。

---

## 実験4: 画像特徴の加味
### 手順
施設紹介文だけでは機能面に偏りがちであるという仮説のもと、観光客が撮影したFlickrの画像が持つ「雰囲気」の情報を加えることを試みました。
- **使用モデル**: CLIP（テキストと画像を共通空間で扱えるため）
- **統合手法**: POIのテキストベクトルに対し、周辺で撮影された画像のベクトルを、POIと撮影地の距離に応じて重み付け（正規分布を利用）して加算しました。
  ```math
  combined\_vector = \alpha \cdot \text{text\_vector} + (1-\alpha) \frac{\sum (w_{geo} \cdot \text{image\_vector})}{\sum w_{geo}}
  ```
  ただし、テキストと無関係な画像ベクトルがノイズになることを防ぐため、テキストベクトルと画像ベクトルの類似度が中央値(`0.2287`)以上の画像のみを利用しました。

### 結果
[**実験4の結果**](..docs/results/4.md)

- **類似度分布**:
  <img src="./images/similarity_distribution_with_distance.png" alt="画像ベクトルとテキストベクトルの類似度の傾向" width="600px">
  <details>
    <summary>類似度スコア詳細 (クリックで展開)</summary>
    - 分析対象POI数: 29/50
    - 総類似度ペア数: 5035
    - 中央値: 0.2287
    - 上位25%のしきい値: 0.2523
    - 上位10%のしきい値: 0.2716
    - 上位5%のしきい値: 0.2822
  </details>

- **事例（ラッキーピエロ ベイエリア本店）**: テキストとの類似度が非常に高い（`0.3361`）と判定された画像は、近隣の「ハセガワストア」を写したものでした。
  ![ハセガワストア ベイエリア店](./images/54265577347_0653c055f1.jpg)<br>
  *Photo by [inunami](https://www.flickr.com/photos/94693136@N05/) / [CC BY 2.0](https://creativecommons.org/licenses/by/2.0/deed.en)*

### 考察
テキストとの類似度が高いと判定された画像が、必ずしもそのPOIの「雰囲気」を正しく表現しているとは限らないことが明らかになりました。「ラッキーピエロ」の雰囲気を表現するために「ハセガワストア」の画像を加えるのは不適切だと考えます。他の事例を見ても、関係のない画像が多数含まれており、単純な類似度でのフィルタリングには限界があると結論付けました。

---

## 今後の計画
### 5. GNNによる地区特性の再定義
階層的クラスタリングの課題を踏まえ、今後はGraph Neural Network (GNN)を用いて地区特性の抽出を試みます。各POIをノードとし、POI間の関係性（距離やカテゴリの近さなど）をエッジとしてグラフを構築。GNNによって得られる各POIのベクトル表現に基づきクラスタリングすることで、よりデータドリブンな「エリア」を定義できると期待しています。

### 6. ロードサイドPOIの景観評価
(Zheng et al., 2013) の研究を参考に、ドライブ観光における沿道の景観的魅力を評価する手法を取り入れ、ルート推薦の質の向上を目指します。

---

## 総合的な考察・今後の検討事項
- **検索精度の向上**:
  現状のベクトル類似度検索では、「美味しいコーヒー」と検索してもコーヒー自体を提供しない関連施設が上位に来ることがあります。これを改善するため、TF-IDFやBM25、SPLADEのような古典的・現代的なテキストマイニング手法を組み合わせ、キーワードのマッチング精度を向上させる必要があります。

- **地区特性の役割の再検討**:
  仮に検索システムを高度化できたとして、本研究のコアである「地区特性」をルート生成プロセスのどこに組み込むのか、その役割を再定義する必要があります。

- **ベクトル表現の改善**:
  テキスト理解はSentence-BERT、画像との連携はCLIPと、現状ではそれぞれのモデルに長所があります。Sentence-BERTの埋め込み表現をCLIPのベクトル空間に写像するようなファインチューニングも、今後の選択肢として考えられます。

- **画像情報の扱い**:
  単純な画像ベクトルの加算はノイズが多いことが分かりました。今後は、YOLOのような物体検出モデルを用いて画像の内容をフィルタリングするか、あるいは画像は使わずに周辺のPOIの統計情報（口コミ数など）を「雰囲気」の代理特徴として利用する方が現実的かもしれません。まずは後者のアプローチから試みる予定です。